---Overview---------------------------------------------------------------------

    https://helpwithcovid.com/projects/252-bluetooth-stethoscope-pulse-oximeter

Scope:
    We're looking for a functional stethoscope that a doctor can use to listen
    to a patient's vitals, while wearing full protective gear.  A stethoscope on
    a hose is clumsy, not helpful with protective gear (facemask, hooded garment);
    additionally its ackward to disinfect a stethoscope between patients.  An ideal
    solution would be a device that could be wrapped in a disposable covering (perhaps
    a rubber glove?) between patients.

---Open Source Hardware Repos---------------------------------------------------

    https://en.wikipedia.org/wiki/List_of_open-source_hardware_projects

    https://en.wikipedia.org/wiki/List_of_open-source_health_software

    Screw it.. Github for the win.

---stupid dumb question for team - Stereo ?-------------------------------------

    LBC note: I was looking at the spec sheet for the AdaFruit MEMS microphone.
    You can use two for stereo.  Wow.  We each have two ears.  Is there any advantage
    to the quality of stethoscope use by providing true stereo performance?
    Perhaps an oval shaped cone? That would increase power usage, but it might
    be a big improvement in the quality of the device's output (?)

---Resources on hand------------------------------------------------------------

    LBC notes:

    3d printer makerbot, heated bed, working envelope:  225x145x150 millimeters or 8.9 x 5.7 x 5.9 inches
    material PLC (a small bit left) ABS (brand new unopened box)
    https://www.cnet.com/reviews/makerbot-replicator-review/
    https://picclick.com/MakerBot-Replicator-Dual-Extrusion-2-color-printing-3D-Printer-162737354718.html

    Hakko Fx-888 soldering iron.
    old skool power supply, old skool analog oscilloscope

    Access to Orange Pi's, Raspberry Pi's, ESP32 (with both Wifi and BT)

    At one point in time I started an inventory of my electronic parts.
    https://docs.google.com/spreadsheets/d/1TP7NCWNiXR75lc__cfYYinlH-1VoV7KbM1oV_g3vnZg/edit?usp=sharing
    I only have one microphone chip, a AdaFruit Mems development board (I2S)
    I'm going to check my buddies stock & steal (er, borrow) what he has available.
    He thinks he may have some electret condenser microphone elements available.
    I'm pretty sure he has a huge quantity of resistors and capacitors for most needs.

---Listening to heart rate---------------------------------------------------------

    https://forum.allaboutcircuits.com/threads/best-microphone-to-detect-heartbeat.155369/

    oops.  Heart rate isn't our primary objective.. its listening to a patient's
    lungs.

    Mike Vang's comment:
        Some of the boards out there like the MAX30100 can serve dual purpose such as
        getting SpO2 measurement and heart rate sensor.

        Including heart rate measurement is a feature that could always be adding if
        using something like a MAX30100 board.

---what about listening to lungs?-----------------------------------------------

    Nice overview paper.
    https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6101681/
    Respiratory sound analysis in the era of evidence-based medicine and the
    world of medicine 2.0
    E Andrès,* R Gass,** A Charloux,*** C Brandt,**** and A Hentzler*****

    Kraman et al. [17] studied the effects of different microphones and concluded
    that the most effective one was the electret microphone with conical coupler,
    10-15mm in diameter;

    Frick, the Kraman study was done in 1995.  Way before cell phones high volume MEMS
    mikes... https://www.ncbi.nlm.nih.gov/pubmed/7555110/
    Measurement of respiratory acoustic signals. Effect of microphone air cavity
    width, shape, and venting.  Kraman SS1, Wodicka GR, Oh Y, Pasterkamp H.

    (oops. I only have mems microphone...)

    Electret vs mems?
    https://forum.digikey.com/t/electret-condenser-ecm-vs-mems-microphone/447
    Electret condenser microphone (ECM microphone) apply the principle of capacitor
    charge/discharge for operation. The diaphragm acts as one plate of a capacitor,
    the vibration is generated due to the sound, then produce the changes of
    charge between the plates to make the signal transmission.

    Since the vibration is purely an electromechanical mechanism, it has the
    whole acoustic frequency response (0-20kHZ) and low distortion in the signal
    transmission, generally used in external portable microphone. Its shortcoming
    is being unable to undertake a re-flow soldering, so there is a specific
    soldering process and tools for manual soldering.

---ESP-32-----------------------------------------------------------------------

    https://www.aliexpress.com/item/32801296418.html?src=google&src=google&albch=shopping&acnt=768-202-3196&isdl=y&aff_short_key=UneMJZVf&slnk=&plac=&mtctp=&albbt=Google_7_shopping&aff_platform=google&&albcp=9603941227&albag=96253190102&trgt=297309937605&crea=en32801296418&netw=g&device=c&albpg=297309937605&albpd=en32801296418&gclid=Cj0KCQjwpfHzBRCiARIsAHHzyZr4OGfWuGPSdq0CqLSSRd4H_1mqvi2yu0oduqNAtVLHI9zTAtB1Z9saAvgIEALw_wcB&gclsrc=aw.ds

    Power Consumption?
    https://esp32.com/viewtopic.php?t=2662
    VCC=5V     N. CORES ACTIVE: DEFAULT

    SCENARIO-------------------------------CPU80MHz-----------CPU160MHz---------CPU240MHz
    - CPU + ELECTRONICS + BT----------------113mA----------------123mA------------141mA
    - CPU + ELECTRONICS----------------------38mA---------------- 51mA ------------73mA
    - CPU (deep sleep) + ELECTRONICS--------3.5mA----------------3.5mA------------3.5mA

    AA battery (1.5v) life: 2400 mAhours
    AAA battery: 1000 mAhours

    Mike Vang's comment: https://www.tinycircuits.com sells lithium batteries.
        https://tinycircuits.com/collections/batteries
            All 3.7v; 70 mAH to 2500 mAH
           70 mAH   150 mAH     290 mAH     500 mAH     850 mAH     1000 mAH    1100 mAH    2500 maH
           $3.49    $3.95       $5.95       $6.95       $8.49       $9.95       $$9.95      $5.95

        Micro USB batter charger---$6.95

    While executing WiFi.scanNetworks() function very first time, module consumes
    average current of 0.5A for 10 ms with four peaks of approx. 0.7A during that
    period.  After that module consumes average 130 mA with 0.6A current spikes.
    The spikes have duration of 0.5 ms and appear in bursts with spike rate of 100 ms.

    Apparently it is about 2 times worse than promised in the ESP-32 data sheet.
    I expected to see about 0.3A max (50 mA for CPU and 240 mA max for WiFi
    transmitter).

    Can ESP32 handle I2S?  Can it perform A to D?
    https://demo-dijiudu.readthedocs.io/en/latest/api-reference/peripherals/i2s.html
    ESP32 contains two I2S peripherals. These peripherals can be configured to
    input and output sample data via the I2S driver.  The I2S peripheral supports
    DMA meaning it can stream sample data without requiring each sample to be
    read or written by the CPU.  I2S output can also be routed directly to the
    Digital/Analog Converter output channels (GPIO 25 & GPIO 26) to produce
    analog output directly, rather than via an external I2S codec.

    https://github.com/espressif/esp-idf  (Is this all ESP32's?)
    https://docs.espressif.com/projects/esp-idf/en/latest/esp32/hw-reference/index.html

---ESP32 General Specs----------------------------------------------------------

    https://en.wikipedia.org/wiki/ESP32
    Features of the ESP32 include the following:[3]

    Processors:
    CPU: Xtensa dual-core (or single-core) 32-bit LX6 microprocessor, operating
        at 160 or 240 MHz and performing at up to 600 DMIPS
    Ultra low power (ULP) co-processor
    Memory: 520 KiB SRAM
    Wireless connectivity:
    Wi-Fi: 802.11 b/g/n
    Bluetooth: v4.2 BR/EDR and BLE (shares the radio with Wi-Fi)
    Peripheral interfaces:
    12-bit SAR ADC up to 18 channels
    2 × 8-bit DACs
    10 × touch sensors (capacitive sensing GPIOs)
    4 × SPI
    2 × I²S interfaces
    2 × I²C interfaces
    3 × UART
    SD/SDIO/CE-ATA/MMC/eMMC host controller
    SDIO/SPI slave controller
    Ethernet MAC interface with dedicated DMA and IEEE 1588 Precision Time Protocol support
    CAN bus 2.0
    Infrared remote controller (TX/RX, up to 8 channels)
    Motor PWM
    LED PWM (up to 16 channels)
    Hall effect sensor
    Ultra low power analog pre-amplifier

---WebBlueTooth-----------------------------------------------------------------

    https://www.smashingmagazine.com/2019/02/introduction-to-webbluetooth/

    https://webbluetoothcg.github.io/web-bluetooth/
    Web Bluetooth -- Draft Community Group Report, 20 March 2020

    https://github.com/opengatt/registry

    Nordic Uart
    A generic service for reading and writing streams of bytes
    https://github.com/opengatt/registry/tree/master/services/uart
    Peripheral Implementations -- BLEStream Arduino
    Client Implementations -- ble-serial JavaScript (Node.js and Browser)

    Current status of audio over BLE (Android, iOS)
    https://www.silabs.com/community/wireless/bluetooth/forum.topic.html/current_status_ofau-u3gE

    LBC note: After looking closely at some of these details, I cannot imagine
    WebBlueTooth will manage a decent audio stream.  too much data.

    Never mind that this discussion was for the remote Telemedicine out of scope
    proposal.   A doctor needs to use a stethoscope to manage tube insertions to
    a patient right in from of them.  this is not a telemedicine conversation.

---Deals tied to the helpwithcovid.com site-------------------------------------

    See listing at: https://helpwithcovid.com/offers

    https://www.mygatorwatch.com/Default.asp
    Free watch (cell phone, geo locator) for elders in need. Interesting, but
    doesn't fit our proposal.  Might be a contact when it comes time for manufacturing...

    SMS texting from Chatbox...
    could be nice, not needed here. Ha.  Lost your stethoscope, send a text page.
    Er... no. just no...

    I was actually looking for server space.. and with current project scope that's
    unnecessary.

---Blood Oxygen level measurement?----------------------------------------------

    https://en.wikipedia.org/wiki/Pulse_oximetry

    Reflective Mode:

    These are good articles/papers about reflective-mode oximetry:
    https://www.sciencedirect.com/science/article/pii/S2405959516301205
    https://web.wpi.edu/Pubs/E-project/Available/E-project-042413-160152/unrestricted/Final_MQP_Report.pdf

    I don't see any currently available commercial reflective-mode solutions though.
    This article:  https://core.ac.uk/download/pdf/81961664.pdf  (page 2) shows a prototype reflective-mode circuit.  This has a
     microcontroller but otherwise doesn't look very complicated, we could possibly prototype one.

    Transmissive Mode:

    Apparently fingertip-or-earlobe oximetry is "transmissive mode" oximetry.  "Reflective mode" oximetry is possible at the
    wrists, chest or other sites, so this could theoretically be integrated into a stethoscope puck. The hardware is likely different
    than current market solutions, more research is necessary.

     If transmissive mode (fingertip) sensors would work, it's cheaper to source battery-operated units, one per patient.
     They look difficult to sterilize though.

    I found this Maxim Max30100 pulse oximiter/heartrate module and a review:
      https://www.teachmemicro.com/max30100-arduino-heart-rate-sensor/

    There are a couple different board versions, one is cheaper but harder to work with.
    The more expensive one is about $6/unit on Alibaba, don't know about availability.

    Mike Vang's comment:
        One could combine an electronic stethoscope with an oximeter.

        The paper that is shared below says that a reflectory pulse oximeter has more
        diverse locations it could take like from the feet, head, chest and wrist.
        Accuracy becomes an issue though.

        Reflectory pulse oximeter's has two LED's on one side (red and infrared). I
        think that many pulse oximeter like the Max30100 is a reflectory pulse
        oximeter.

        But we run into an issue: the base that touches the client is enlarged to
        include both a stethoscope and a pulse oximeter.

        Ref:
            https://www.sciencedirect.com/science/article/pii/S1877705812022060

---High Tech Question-----------------------------------------------------------

    Once you've gone digital, are there other tools we're interested in?
    e.g. Digital Signal Processing including filtering, Frequency domain analysis?

    LBC Note: I've recently finished the Coursera class (Mar 2018)--
    Audio Signal Processing For Music Applications
    https://www.coursera.org/learn/audio-signal-processing
    https://online.stanford.edu/courses/sohs-ymusic0001-audio-signal-processing-music-applications

    Meghana... the code work was all done in Python!

    At the time I wanted to use raspberry pi microphone for an interactive dynamic
    outdoor art project in downtown Las Vegas.  I also got bashed hard at a
    hackathon for a mining project, using a microphone / pi system to monitor
    pending mineshaft pump failures.  Great idea, i didn't really understand the
    nuances of Fast Fourier Transforms for live monitoring.  The class was
    really good at forcing you to understand what's going on.

---BlueTooth Linkup-------------------------------------------------------------

    The topic started as a conversation with my research scientist buddy Dirk,
    do we really need a visible screen?  And it gets down to how do you pair
    a digital stethoscope with a Bluetooth headset, if neither of them has a
    visible screen.  What if you are in a location that has lots of other
    Bluetooth devices present?

    One way is to lock the devices together using a dedicated "mac" address.
    You can permanently link the headset to a particular Bluetooth stethoscope.
    Easy to do when you are just making one set, not so easy to do when you need
    fifty or a 1000 of these.  And then if permanently paired, what happens
    when there is a problem with either (expensive) device?  You have to throw
    both pieces away.

    I think that means a OLED display screen is required, to manage the Bluetooth
    pairing process, sigh.  And momentary buttons for up / down / select.

    An exceptional reference on this stuff?  (ESP32, IOT stuff, Bluetooth)

    https://randomnerdtutorials.com/   From Rui and Sara Santos

    see:  Dedicated mac addresses for bluetooth devices.
          Blue tooth Advertising

---membrane?--------------------------------------------------------------------

    What to use for a stethoscope membrane?
    Ideas: sheet plastic
           plastic lid from a can of peanuts
           clean bottom of steel can
           Thin aluminum sheet (Coke Can)

---Open Source Licenses---------------------------------------------------------

    https://choosealicense.com/licenses/
    https://opensource.guide/legal/#which-open-source-license-is-appropriate-for-my-project

---Design of Experiments / Analysis of Variance---------------------------------

    ref: https://dogfeatherdesign.com/simple-design-of-experiments-analysis-of-variance-anova/

    Design Factors?
        --microphone type MEMS vs Electret Condenser microphone element
        --bell shape (parabola vs cone)?
        --Membrane material? (thin plastic sheet, thick plastic sheet, thin steel)
        --size of bell (big or small)
        --recording test master (what are we listening to?  Anybody have a
        master recording of the chest of someone with pneumonia? )

    Response (What's the measure of success?)
        idea: find a master recording of XYZ at a fixed volume level.
        (pick a couple of different ones)
        Play the master recording thru a speaker.
        Record with the digital stethoscope, perform FFT spectrogram analysis on
        the recording.

---Work of others in analysing Microphone performance---------------------------

    https://www.testandmeasurementtips.com/test-and-measurement-basics-of-microphones/

    google search terms: analyse different microphone performance using spectrogram

    https://en.wikipedia.org/wiki/Spectrogram
    A spectrogram is a visual representation of the spectrum of frequencies of a
    signal as it varies with time. When applied to an audio signal, spectrograms
    are sometimes called sonographs, voiceprints, or voicegrams. When the data
    is represented in a 3D plot they may be called waterfalls.

    https://link.springer.com/article/10.1007/s11334-019-00325-7
    Development and performance analysis of a low-cost MEMS microphone-based
    hearing aid with three different audio amplifiers
    Souvik Mallik, Debjyoti Chowdhury & Madhurima Chttopadhyay

    Interesting reference:
    https://superuser.com/questions/324469/spectrum-analyzer-that-shows-live-input-from-the-microphone

---Lung Sounds------------------------------------------------------------------

    https://www.youtube.com/watch?v=2NvBk61ngDY
    Lung sounds (respiratory auscultation sounds)
    Mar 7, 2018 -- Geeky Medics

    https://geekymedics.com/respiratory-examination-2/

---3D printed Stethoscope-------------------------------------------------------

    3D-Printed stethoscope:
    https://all3dp.com/3d-printed-stethoscope/

---Stethoscope with Core Attachment---------------------------------------------

    Attach-to-stethoscope page:  (removes all re-engineering of stethoscope)
    https://www.harriscomm.com/eko-stethoscope-with-core-attachment.html

---Stethoscope Design Information-----------------------------------------------

    How does a stethoscope work?
    https://www.scientificamerican.com/article/bring-science-home-stethoscope/ (kids basic info)

    https://en.wikipedia.org/wiki/Stethoscope
    oops. --> Rappaport and Sprague designed a new stethoscope in the 1940s, which
    became the standard by which other stethoscopes are measured, consisting of
    two sides, one of which is used for the respiratory system, the other for the
    cardiovascular system  (LBC note, which bell is for which?)

    And this -->  The simplest and least effective method of sound detection is
    achieved by placing a microphone in the chestpiece. This method suffers from
    ambient noise interference and has fallen out of favor. Another method, used
    in Welch-Allyn's Meditron stethoscope, comprises placement of a piezoelectric
    crystal at the head of a metal shaft, the bottom of the shaft making contact
    with a diaphragm. 3M also uses a piezo-electric crystal placed within foam
    behind a thick rubber-like diaphragm. The Thinklabs' Rhythm 32 uses an
    electromagnetic diaphragm with a conductive inner surface to form a capacitive
    sensor. This diaphragm responds to sound waves, with changes in an electric
    field replacing changes in air pressure. The Eko Core enables wireless
    transmission of heart sounds to a smartphone or tablet.

    https://insidefirstaid.com/diagnosis/the-best-littman-stethoscope-master-cardiology-and-classic-comparison
    Bells work similarly to diaphragms, but the hollow cavity in a bell has no
    membrane across it. Traditionally bells are used to listen to low frequency
    sounds.

    Although many stethoscopes come with a bell, there is disagreement in the
    medical community whether bells are useful or obsolete. Bells are traditionally
    thought to be better for hearing low-frequency sounds like some heart murmurs
    and bowel sounds while diaphragms are better for high frequency murmurs and
    lung sounds

    See also https://en.wikipedia.org/wiki/Pinard_horn

---Stemoscope-------------------------------------------------------------------

    https://www.stemoscope.com/
    Stemoscope - a commercially available Bluetooth listening device

    A quick run down: Stemoscope is not a medical device. It is marketed for STEM purposes.
    Features:
        Two listening modes:
            Bell mode (20-200 Hz) used for listening to heart beats
            Diaphram mode (100-500 Hz) used for listening to breathing
        Bluetooth
            Only works through phone app cannot be used with headphones/headsets
            Does not feature pairing
        App
            Supports:
                iPhones, iPads, iPad Touch w/iOS v7.0+ that supports BLE (Bluetooth Low Energy)
                Android 5.0+ devices that supports BLE
        Record samples into .WAV formats.
        Physical dimensions:
            38 mm in diameter and 11 mm thick
            ~1.5 inches in diameter and ~0.43 inches thick

    Stemoscope and it's role against COVID-19:
        https://www.stemoscope.com/stemoscope-in-fighting-covid-19-disease-lung-sounds/

    Stemoscope FAQ:
        https://www.stemoscope.com/faqs/

---Digital Recording Stethoscope------------------------------------------------

    https://multimedia.3m.com/mws/media/116424O/full-line-product-catalog-3m-littmann-stethoscopes.pdf
    This not exactly the same thing.  Its a stethoscope with a built in bluetooth
    enabled digital recorder, intended to allow a physician to send a recording
    to a nearby computer for further analysis.

    US$399 -- Littmann Electronic Stethoscope 3200
    US$299 -- Eko CORE Digital Stethoscope
    US$499 -- Thinklabs One Digital Stethoscope

    https://www.thinklabs.com/
    This is the stethoscope in the image with the wifi adapter and the apple earbuds.
    Thinklabs One solves auscultation via PPE. See Johns Hopkins preparation for COVID-19.

---Thinklabs and Covid 19-------------------------------------------------------

    https://www.thinklabs.com/covid19
    https://www.cbsnews.com/news/coronavirus-containment-dr-jon-lapook-60-minutes-2020-03-08/
    https://www.thinklabs.com/infectious-disease-and-biocontainment

    Biocontainment presents a unique challenge for auscultation. With the Centers
    for Disease Control calling for personal protective equipment (PPE) in treating
    patients for the coronavirus, how does the clinician place stethoscope eartips
    in the ears for listening? Auscultation at the bedside using a conventional
    style stethoscope with tubing becomes impossible.

    Thinklabs One's unique stethoscope design allows healthcare workers to perform
    ausculation while being protected in an isolation environment, and can be
    used with protective covers in the ED to reduce contamination when pre-screening
    admissions.

    The One can be used directly using earbuds or headphones, via bluetooth
    transmitters within the isolation room or to a consultant outside the room,
    connected to a loudspeaker, or send sounds via email or instant messaging on
    iPhone or iPad.

    PPE
    -Personnel are donning disposable earbud headphones inside PPE or headsets
     over PPE.
    -If inside, the earbud/headphone cable is then snaked out of the protective
     clothing, to be connected, external to the clothing, to the Thinklabs One
     Digital Stethoscope. The clinician can then listen clearly to patient sounds
     while being fully suited up.  (LBC notes...Ugh...  Really?  A bluetooth radio
     chip costs like $1.00 in production. Opinion: any manufacturer of anything
     with electrons, who doesn't include a bluetooth or wifi chip these days is
     dumb, if not just purely for marketing buzz and hype.)

    Ziploc Protection for Primary Care and ED
    -One group of researchers developed a simple and practical way to treat multiple
     infectious patients using resealable Ziploc plastic bags. They connected the
     stethoscope to a Bluetooth transmitter and then placed the device inside of
     up to ten-yes, ten-resealable Ziploc plastic bags. The bags were sequentially
     removed to reveal a clean surface for listening to patients.

    -The Ziploc method is a novel way to take advantage of the Thinklabs One form
     factor. The entire stethoscope and Bluetooth transmitter fit inside a sealed
     bag.

    -This is ideal for ED and primary care use, where protection is highly
     desirable, but PPE impractical.

    terms:
    ausculation - the action of listening to sounds from the heart, lungs, or
    other organs, typically with a stethoscope, as a part of medical diagnosis.
    ED - Emergency Department (?)

---ThinkLabs References---------------------------------------------------------

    Engineering Library and Downloads:
    https://www.thinklabs.com/user-manuals

    http://thinklabsone.com/AudacityManual/ThinklabsAudacityHelp.html
    A Free, Open Source, Cross-Platform Audio Editor -- Specially designed for
    Heart Sound and Lung Sound Visualization and Analysis

    https://www.thinklabs.com/sound-library
    The Sound Library is a collection recorded on Thinklabs stethoscopes
    by our user community.  Includes both heart and lung sounds.
    (oops.. nothing here)

    Instead check out the Thinklabs youtube channel,
    https://www.youtube.com/playlist?list=PLLKSXV1ibO86qgE2y9cMqNFmh6LfOa8RM
    Lung Sounds -- 15 videos

---GrabCad Stuff----------------------------------------------------------------

    Lots of reference stuff available at https://grabcad.com/library
    including a whole bunch of Covid PPE devices and related work of others.

    https://grabcad.com/library/digital-stethoscope-1
    digital stethoscope
    Adriano Ordoz Barissa (Cravinhos, Brazil)
    October 11th, 2017
    The idea for this product is to make a stethoscope easy to use in order to be used in hospitals and residences.
    (LBC note.  I sent a note to Adriano thru grabcad, asking for input, perhaps get him to join team. 3/29/2020, 4:30PM PST)

---Idea-------------------------------------------------------------------------

    ESP32 devices have multiple wireless Inputs/output systems.  We could use
    bluetooth for heart/lungs audio, and use an other channel for battery life
    monitoring (I'm thinking a hospital has 20 of these things.. How many have low
    batteries?)  LoRa band can easily handle that little bit of IoT (internet of things)
    traffic, reminding hospital folks that units 1, 9 and 13 are running low and need
    to be charged...
    
---Digital Signal Processing on a DSP32. Possible?------------------------------

    I was thinking about the simple in/out audio box design.  What if we needed DSP 
    filtering?  Not sure ESP32 is the best choice, but its available and 
    relatively inexpensive.  

    Heck yeah.  Wow.  I'm blown away that this library exists.
    https://github.com/espressif/esp-dsp
    https://hackaday.io/project/166122-esp32-as-bt-receiver-with-dsp-capabilities
